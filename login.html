<!DOCTYPE html>
<html>
<head>
    <title>AIVA Login</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: linear-gradient(135deg, #6366f1, #06b6d4); height: 100vh; display: flex; align-items: center; justify-content: center; }
        
        .login-container { background: white; padding: 40px; border-radius: 16px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); width: 400px; }
        .logo { text-align: center; margin-bottom: 30px; }
        .logo h1 { color: #6366f1; font-size: 32px; margin-bottom: 10px; }
        .logo p { color: #6b7280; font-size: 14px; }
        
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 8px; color: #374151; font-weight: 500; }
        .form-group input { width: 100%; padding: 12px 16px; border: 1px solid #d1d5db; border-radius: 8px; font-size: 14px; outline: none; }
        .form-group input:focus { border-color: #6366f1; box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1); }
        
        .login-btn { width: 100%; background: linear-gradient(135deg, #6366f1, #06b6d4); color: white; border: none; padding: 12px; border-radius: 8px; font-size: 16px; cursor: pointer; margin-top: 10px; }
        .login-btn:hover { opacity: 0.9; }
        
        .two-factor { display: none; }
        .two-factor.show { display: block; }
        .otp-input { text-align: center; font-size: 18px; letter-spacing: 8px; }
        .resend-code { color: #6366f1; cursor: pointer; font-size: 12px; margin-top: 10px; }
        
        .forgot-password { text-align: center; margin-top: 20px; }
        .forgot-password a { color: #6366f1; text-decoration: none; font-size: 14px; }
    </style>
</head>
<body>
    <div class="login-container">
        <div class="logo">
            <h1>ðŸ¤– AIVA</h1>
            <p>AI-Powered Support Assistant</p>
        </div>
        
        <form onsubmit="login(event)" id="loginForm">
            <div class="form-group">
                <label for="email">Email</label>
                <input type="email" id="email" required placeholder="Enter your email">
            </div>
            
            <div class="form-group">
                <label for="password">Password</label>
                <input type="password" id="password" required placeholder="Enter your password">
            </div>
            
            <button type="submit" class="login-btn" id="loginBtn">Login to Dashboard</button>
        </form>
        
        <div class="two-factor" id="twoFactorDiv">
            <div class="form-group">
                <label for="otpCode">Enter 6-digit code sent to your email</label>
                <input type="text" id="otpCode" maxlength="6" class="otp-input" placeholder="000000">
            </div>
            
            <button type="button" class="login-btn" onclick="verifyOTP()">Verify Code</button>
            <div class="resend-code" onclick="resendCode()">Resend code</div>
        </div>
        
        <div class="forgot-password">
            <a href="#">Forgot your password?</a>
        </div>
    </div>

    <script>
        let generatedOTP = '';
        
        async function login(event) {
            event.preventDefault();
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            
            if (email && password) {
                try {
                    const response = await fetch('/api/send-otp', {
                        method: 'POST',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify({ email: email })
                    });
                    
                    const result = await response.json();
                    
                    if (result.success) {
                        // Hide login form, show 2FA
                        document.getElementById('loginForm').style.display = 'none';
                        document.getElementById('twoFactorDiv').classList.add('show');
                        
                        alert(`Verification code sent to ${email} from AI Complaint System. Check your email inbox.`);
                    } else {
                        alert('Failed to send verification code');
                    }
                } catch (error) {
                    alert('Error sending verification code');
                }
            } else {
                alert('Please enter both email and password');
            }
        }
        
        async function verifyOTP() {
            const enteredOTP = document.getElementById('otpCode').value;
            const email = document.getElementById('email').value;
            
            try {
                const response = await fetch('/api/verify-otp', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ email: email, otp: enteredOTP })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    localStorage.setItem('userEmail', email);
                    alert('Login successful!');
                    window.location.href = `/dashboard?email=${encodeURIComponent(email)}`;
                } else {
                    alert('Invalid code. Please try again.');
                    document.getElementById('otpCode').value = '';
                }
            } catch (error) {
                alert('Error verifying code');
            }
        }
        
        async function resendCode() {
            const email = document.getElementById('email').value;
            
            try {
                const response = await fetch('/api/send-otp', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ email: email })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    alert('New verification code sent from AI Complaint System. Check your email.');
                } else {
                    alert('Failed to resend code');
                }
            } catch (error) {
                alert('Error resending code');
            }
        }
    </script>
</body>
</html>